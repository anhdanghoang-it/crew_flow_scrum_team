{"module_name":"trading_simulation_core","executive_summary":"Comprehensive test plan covering the core trading simulation features (Account Initialization, Cash Management, Trading, and Transaction History) based on user stories US-001 through US-004. Tests validate functional requirements, data integrity (currency formatting, metric calculation), and robust error handling for insufficient funds/shares and API failures.","scenarios":[{"test_id":"TS-1.1","title":"Successful Account Initialization and Dashboard Display (Happy Path)","source_user_story_id":"US-001","detailed_steps":[{"step_number":1,"action":"Navigate to the application URL (http://127.0.0.1:7860/).","expected_outcome":"Application loads successfully, displaying the 'Initial Setup' group and hiding the 'Portfolio Overview' group."},{"step_number":2,"action":"Enter '100000.00' into the 'Initial Deposit' input field (ref: locator('#initial_deposit_input input')).","expected_outcome":"The value is correctly entered."},{"step_number":3,"action":"Click the 'Start Simulation' button (ref: locator('#start_sim_button')).","expected_outcome":"The account state is initialized."},{"step_number":4,"action":"Verify the 'Initial Setup' group is now hidden and the 'Portfolio Overview' group is visible.","expected_outcome":"UI transition is complete."},{"step_number":5,"action":"Verify a success information message is displayed: 'Account initialized with a balance of $100,000.00.'.","expected_outcome":"The user receives positive feedback."},{"step_number":6,"action":"Verify the 'Cash Balance' metric displays '$100,000.00'.","expected_outcome":"Cash balance reflects the initial deposit with correct currency formatting."},{"step_number":7,"action":"Verify all main tabs ('Trade', 'Cash Management', 'Transaction History') are enabled.","expected_outcome":"Navigation is unlocked."}],"expected_result":"Account is successfully initialized with $100,000.00, the setup UI hides, the dashboard appears, and key metrics are displayed correctly.","user_story_detail":"As a Trader, I want to set an initial account balance and view a dashboard of my key portfolio metrics, so that I have a starting point for my simulation and can track my performance at a glance."},{"test_id":"TS-1.2","title":"Validation: Initializing with Non-Positive Amount","source_user_story_id":"US-001","detailed_steps":[{"step_number":1,"action":"Navigate to the application URL.","expected_outcome":"Application loads, showing 'Initial Setup' UI."},{"step_number":2,"action":"Enter '0' into the 'Initial Deposit' input field.","expected_outcome":"The value is entered."},{"step_number":3,"action":"Click the 'Start Simulation' button.","expected_outcome":"The initialization logic runs."},{"step_number":4,"action":"Verify an error message is displayed: 'Initial deposit must be a positive number.'.","expected_outcome":"Error validation is triggered."},{"step_number":5,"action":"Verify the 'Initial Setup' group remains visible and the 'Portfolio Overview' group remains hidden.","expected_outcome":"Account state is unchanged."},{"step_number":6,"action":"Repeat steps 2-5 using a negative amount, e.g., '-50.00'.","expected_outcome":"Same error message and state persistence is observed."}],"expected_result":"Initialization fails for non-positive amounts, displaying the required error message, and the setup UI remains visible.","user_story_detail":"Attempting to initialize with invalid input (Non-positive amount): When I enter '0' into the initial deposit field and click 'Start Simulation', the account state should not change, and I should see an error message: gr.Error('Initial deposit must be a positive number.')."},{"test_id":"TS-2.1","title":"Successful Deposit of Funds (Happy Path)","source_user_story_id":"US-002","detailed_steps":[{"step_number":1,"action":"Setup: Initialize account with $10,000.00.","expected_outcome":"Cash Balance is $10,000.00."},{"step_number":2,"action":"Navigate to the 'Cash Management' tab (ref: locator('//div[@role=\"tab\"][.=\"Cash Management\"]')).","expected_outcome":"Cash Management interface is displayed."},{"step_number":3,"action":"Enter '5000.00' into the 'Deposit Amount' input (ref: locator('#deposit_input input')).","expected_outcome":"Amount is entered."},{"step_number":4,"action":"Click the 'Deposit' button (ref: locator('//button[.=\"Deposit\"]')).","expected_outcome":"Deposit transaction is processed."},{"step_number":5,"action":"Verify a success message: 'Successfully deposited $5,000.00.'.","expected_outcome":"Confirmation message is displayed."},{"step_number":6,"action":"Navigate back to the 'Portfolio' tab.","expected_outcome":"Portfolio dashboard is visible."},{"step_number":7,"action":"Verify 'Cash Balance' is updated to '$15,000.00' and 'Total Portfolio Value' is '$15,000.00'.","expected_outcome":"Metrics reflect the successful deposit."}],"expected_result":"Funds are successfully deposited, and the cash balance is updated correctly across the application with proper currency formatting. A DEPOSIT transaction is logged.","user_story_detail":"As a Trader, I want to deposit additional funds... so that I can manage my cash balance in the simulation."},{"test_id":"TS-2.3","title":"Error Path: Insufficient Funds for Withdrawal","source_user_story_id":"US-002","detailed_steps":[{"step_number":1,"action":"Setup: Initialize account with $10,000.00.","expected_outcome":"Cash Balance is $10,000.00."},{"step_number":2,"action":"Navigate to the 'Cash Management' tab.","expected_outcome":"Cash Management interface is displayed."},{"step_number":3,"action":"Enter '10001.00' into the 'Withdrawal Amount' input (ref: locator('#withdrawal_input input')).","expected_outcome":"Amount exceeding available balance is entered."},{"step_number":4,"action":"Click the 'Withdraw' button (ref: locator('//button[.=\"Withdraw\"]')).","expected_outcome":"Withdrawal validation runs."},{"step_number":5,"action":"Verify an error message is displayed: 'Withdrawal failed. Insufficient funds. Available: $10,000.00.'.","expected_outcome":"The specific error message for insufficient funds is displayed."},{"step_number":6,"action":"Navigate back to the 'Portfolio' tab and verify 'Cash Balance' remains '$10,000.00'.","expected_outcome":"The cash balance is unchanged."}],"expected_result":"Withdrawal is rejected when the amount exceeds the current cash balance. The account state remains unchanged, and a specific error message detailing the available balance is shown.","user_story_detail":"Attempting to withdraw more funds than available (Validation): When I enter '10001.00' in the withdrawal field and click 'Withdraw', my cash balance remains $10,000.00, and I see an error message: gr.Error('Withdrawal failed. Insufficient funds. Available: $10,000.00.')."},{"test_id":"TS-3.1","title":"Successful Buy Order (Happy Path)","source_user_story_id":"US-003","detailed_steps":[{"step_number":1,"action":"Setup: Initialize account with $50,000.00. (Assume AAPL price is $150.00).","expected_outcome":"Cash Balance is $50,000.00."},{"step_number":2,"action":"Navigate to the 'Trade' tab (ref: locator('//div[@role=\"tab\"][.=\"Trade\"]')).","expected_outcome":"Trade interface is displayed."},{"step_number":3,"action":"Select 'AAPL' from the 'Symbol' dropdown (ref: locator('#symbol_dropdown input')).","expected_outcome":"AAPL is selected."},{"step_number":4,"action":"Enter '10' into the 'Quantity' input (ref: locator('#quantity_input input')). (Total Cost: $1,500.00).","expected_outcome":"Quantity is entered."},{"step_number":5,"action":"Click the 'Buy' button (ref: locator('//button[.=\"Buy\"]')).","expected_outcome":"Buy order is executed."},{"step_number":6,"action":"Verify a success message: 'Successfully purchased 10 shares of AAPL for $1,500.00.'.","expected_outcome":"Confirmation message is displayed."},{"step_number":7,"action":"Navigate to the 'Portfolio' tab and verify 'Cash Balance' is '$48,500.00'.","expected_outcome":"Cash balance is reduced by $1,500.00."},{"step_number":8,"action":"Verify 'Holdings Market Value' is '$1,500.00' and the 'Current Holdings' table reflects 10 shares of AAPL.","expected_outcome":"Holdings are correctly updated."}],"expected_result":"The buy order is successful, cash balance is updated, and the new holding is correctly recorded and displayed in the portfolio dashboard.","user_story_detail":"Successfully buying shares (Happy Path): When I select symbol 'AAPL', enter quantity '10', and click 'Buy', my cash balance should decrease by $1,500.00 and my holdings for 'AAPL' should increase by 10 shares."},{"test_id":"TS-3.4","title":"Error Path: Selling More Shares Than Owned (Short Selling Validation)","source_user_story_id":"US-003","detailed_steps":[{"step_number":1,"action":"Setup: Initialize account with $50,000.00 and execute a buy order for 50 shares of 'TSLA'. (Holdings: 50 TSLA).","expected_outcome":"Account has 50 shares of TSLA."},{"step_number":2,"action":"Navigate to the 'Trade' tab.","expected_outcome":"Trade interface is displayed."},{"step_number":3,"action":"Select 'TSLA' from the 'Symbol' dropdown.","expected_outcome":"TSLA is selected."},{"step_number":4,"action":"Enter '60' into the 'Quantity' input.","expected_outcome":"Quantity exceeding owned shares is entered."},{"step_number":5,"action":"Click the 'Sell' button (ref: locator('//button[.=\"Sell\"]')).","expected_outcome":"Sell order validation runs."},{"step_number":6,"action":"Verify an error message is displayed: 'Sell order failed. You cannot sell 60 shares of TSLA. You only own 50.'.","expected_outcome":"The specific error message for insufficient shares is displayed."},{"step_number":7,"action":"Navigate to the 'Portfolio' tab and verify TSLA holdings remain 50 shares and Cash Balance is unchanged.","expected_outcome":"Account state is preserved."}],"expected_result":"The sell order is rejected because the quantity exceeds owned shares. The account state remains unchanged, and a detailed error message is displayed.","user_story_detail":"Validation: Selling more shares than owned: When I select 'TSLA', enter quantity '60', and click 'Sell', the transaction is rejected, and I should see an error message: gr.Error('Sell order failed. You cannot sell 60 shares of TSLA. You only own 50.')."},{"test_id":"TS-3.5","title":"Edge Case: Price Fetching Service Failure During Trade","source_user_story_id":"US-003","detailed_steps":[{"step_number":1,"action":"Setup: Initialize account with $10,000.00.","expected_outcome":"Cash Balance is $10,000.00."},{"step_number":2,"action":"Navigate to the 'Trade' tab.","expected_outcome":"Trade interface is displayed."},{"step_number":3,"action":"Select 'GOOGL' from the 'Symbol' dropdown (Assume GOOGL triggers the price fetching error).","expected_outcome":"GOOGL is selected."},{"step_number":4,"action":"Enter '1' into the 'Quantity' input.","expected_outcome":"Quantity is entered."},{"step_number":5,"action":"Click the 'Buy' button.","expected_outcome":"Trade logic attempts to fetch the price."},{"step_number":6,"action":"Verify an error message is displayed: 'Could not fetch price for GOOGL. Please try again later.'.","expected_outcome":"The specific error message for API failure is displayed."},{"step_number":7,"action":"Navigate to the 'Portfolio' tab and verify 'Cash Balance' remains '$10,000.00' and holdings remain empty.","expected_outcome":"The trade is aborted without changing the account state."}],"expected_result":"The trade is aborted due to the price fetching failure. The account state is preserved, and a specific, user-friendly error message is displayed.","user_story_detail":"Edge Case: Price fetching service fails: When I attempt to trade 'GOOGL', and the call to get_share_price('GOOGL') returns an API error, the trade should be aborted without changing account state, and I should see an error message: gr.Error('Could not fetch price for GOOGL. Please try again later.')."},{"test_id":"TS-4.1","title":"History Population, Sorting, and Data Integrity Check","source_user_story_id":"US-004","detailed_steps":[{"step_number":1,"action":"Setup: Execute the following sequence of transactions (Assume AAPL price $150.00): 1. Initialize with $10,000.00. 2. Deposit $500.00. 3. Buy 10 AAPL ($1,500 cost). 4. Withdraw $200.00. 5. Sell 5 AAPL ($750 proceeds).","expected_outcome":"Five transactions are logged internally."},{"step_number":2,"action":"Navigate to the 'Transaction History' tab (ref: locator('//div[@role=\"tab\"][.=\"Transaction History\"]')).","expected_outcome":"The transaction history table is displayed."},{"step_number":3,"action":"Verify the table (ref: locator('#history_df')) contains exactly 5 rows.","expected_outcome":"All transactions are present."},{"step_number":4,"action":"Verify the column headers are: 'Timestamp', 'Type', 'Symbol', 'Quantity', 'Price/Share', and 'Total Value'.","expected_outcome":"Table structure is correct."},{"step_number":5,"action":"Verify the rows are sorted in reverse chronological order (Row 1: SELL, Row 5: INIT/DEPOSIT).","expected_outcome":"Sorting criteria are met."},{"step_number":6,"action":"Verify the 'Deposit' transaction row (Type='DEPOSIT') displays 'N/A' or empty strings for 'Symbol', 'Quantity', and 'Price/Share'.","expected_outcome":"Non-trade transaction fields are correctly handled."},{"step_number":7,"action":"Verify the 'Total Value' column formatting and sign: BUY shows negative (e.g., '-$1,500.00'); SELL shows positive (e.g., '$750.00'); WITHDRAWAL shows negative (e.g., '-$200.00'); DEPOSIT shows positive (e.g., '$500.00').","expected_outcome":"Cash flow signs and currency formatting are correct."}],"expected_result":"The transaction history table is correctly populated with all transaction types, sorted descending by timestamp, and currency values accurately reflect cash inflow/outflow with correct formatting.","user_story_detail":"As a Trader, I want to view a history of all my transactions, so that I can review my past trading activity and analyze my decisions. The table must include columns: 'Timestamp', 'Type', 'Symbol', 'Quantity', 'Price/Share', and 'Total Value', with Total Value reflecting cash outflow as negative and inflow as positive."}]}